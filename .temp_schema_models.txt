model contract_editors {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contract_id String    @db.Uuid
  user_id     String    @db.Uuid
  added_by    String    @db.Uuid
  created_at  DateTime  @default(now()) @db.Timestamptz(6)

  contract      contracts @relation(fields: [contract_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user          users     @relation("ContractEditor", fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  added_by_user users     @relation("EditorAdder", fields: [added_by], references: [id], onUpdate: NoAction)

  @@unique([contract_id, user_id], name: "unique_contract_editor")
  @@index([contract_id], map: "idx_contract_editors_contract")
  @@index([user_id], map: "idx_contract_editors_user")
  @@index([added_by], map: "idx_contract_editors_added_by")
}

model contract_audit_log {
  id          BigInt    @id @default(autoincrement())
  contract_id String?   @db.Uuid
  user_id     String?   @db.Uuid
  action      String    @db.VarChar(100)
  entity_type String    @db.VarChar(50)
  entity_id   String?   @db.Uuid
  changes     Json?
  ip_address  String?   @db.Inet
  user_agent  String?
  created_at  DateTime  @default(now()) @db.Timestamptz(6)

  contract contracts? @relation(fields: [contract_id], references: [id], onDelete: SetNull, onUpdate: NoAction)
  user     users?     @relation(fields: [user_id], references: [id], onDelete: SetNull, onUpdate: NoAction)

  @@index([contract_id], map: "idx_audit_log_contract")
  @@index([user_id], map: "idx_audit_log_user")
  @@index([action], map: "idx_audit_log_action")
  @@index([entity_type], map: "idx_audit_log_entity_type")
  @@index([created_at], map: "idx_audit_log_created_at")
  @@index([contract_id, action, created_at], map: "idx_audit_log_contract_action")
}
